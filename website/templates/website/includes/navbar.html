{% load static %}
{% load custom_filters %}

<!-- website/includes/navbar.html -->
<nav class="navbar navbar-expand-lg fixed-top" id="mainNavbar">
    <div class="container-fluid container-lg">
        <!-- Brand Logo -->
        <a class="navbar-brand d-flex align-items-center" href="{% url 'website:home' %}">
            <div class="logo-wrapper">
                <span class="logo-text-primary">ServiceLink</span>
                <span class="logo-text-secondary">BPO</span>
            </div>
        </a>
        
        <!-- Desktop Navigation -->
        <div class="desktop-nav d-none d-lg-flex align-items-center">
            <ul class="navbar-nav mx-auto mb-0">
                <li class="nav-item">
                    <a class="nav-link position-relative px-3" href="{% url 'website:home' %}">
                        <span class="nav-text">Home</span>
                        <span class="nav-hover-effect"></span>
                    </a>
                </li>
                
                <li class="nav-item">
                    <a class="nav-link position-relative px-3" href="{% url 'website:about' %}">
                        <span class="nav-text">About</span>
                        <span class="nav-hover-effect"></span>
                    </a>
                </li>
                
                <!-- Services Mega Menu -->
                <li class="nav-item dropdown mega-menu">
                    <a class="nav-link dropdown-toggle position-relative px-3" 
                       href="{% url 'website:services' %}" 
                       id="servicesDropdown"
                       role="button"
                       data-bs-toggle="dropdown" 
                       aria-expanded="false">
                        <span class="nav-text">Services</span>
                        <span class="nav-hover-effect"></span>
                        <i class="fas fa-chevron-down dropdown-arrow ms-1"></i>
                    </a>
                    <div class="dropdown-menu mega-dropdown p-0 border-0 shadow-lg" aria-labelledby="servicesDropdown">
                        <div class="container-fluid px-4 py-3">
                            <div class="row g-4">
                                <div class="col-lg-8">
                                    <div class="row row-cols-2 g-4">
                                        {% for category in categories|slice:":6" %}
                                        <div class="col">
                                            <a href="{% url 'website:services' %}#{{ category.slug }}" 
                                               class="service-category-card d-flex p-3 text-decoration-none">
                                                <div class="service-icon me-3">
                                                    <i class="{{ category.icon|default:'fas fa-cogs' }}"></i>
                                                </div>
                                                <div>
                                                    <h6 class="mb-1 text-dark fw-semibold">{{ category.name }}</h6>
                                                    <p class="small mb-0 text-muted">{{ category.description|truncatechars:60|default:'Professional services' }}</p>
                                                </div>
                                            </a>
                                        </div>
                                        {% empty %}
                                        <!-- Fallback if no categories -->
                                        {% for i in "123456"|make_list %}
                                        <div class="col">
                                            <a href="{% url 'website:services' %}" 
                                               class="service-category-card d-flex p-3 text-decoration-none">
                                                <div class="service-icon me-3">
                                                    <i class="fas fa-{% cycle 'headset' 'chart-line' 'laptop-code' 'bullhorn' 'database' 'users' %}"></i>
                                                </div>
                                                <div>
                                                    <h6 class="mb-1 text-dark fw-semibold">{% cycle 'Customer Service' 'Finance & Accounting' 'IT Solutions' 'Digital Marketing' 'Data Analytics' 'Back Office' %}</h6>
                                                    <p class="small mb-0 text-muted">{% cycle '24/7 customer support' 'Financial processing' 'IT development' 'Marketing campaigns' 'Data analysis' 'Admin support' %}</p>
                                                </div>
                                            </a>
                                        </div>
                                        {% endfor %}
                                        {% endfor %}
                                    </div>
                                </div>
                                <div class="col-lg-4">
                                    <div class="mega-cta h-100 p-4 border rounded">
                                        <h6 class="mb-3 text-primary fw-bold">Need Custom Solution?</h6>
                                        <p class="small mb-4 text-muted">Let's build a tailored service package for your business needs.</p>
                                        <a href="{% url 'website:contact' %}" class="btn btn-outline-primary w-100">
                                            <i class="fas fa-envelope me-2"></i>Request Quote
                                        </a>
                                        <div class="mt-4 pt-3 border-top">
                                            <div class="d-flex align-items-center mb-2">
                                                <i class="fas fa-check-circle text-primary me-2"></i>
                                                <small class="text-muted">24/7 Support</small>
                                            </div>
                                            <div class="d-flex align-items-center mb-2">
                                                <i class="fas fa-check-circle text-primary me-2"></i>
                                                <small class="text-muted">Custom Solutions</small>
                                            </div>
                                            <div class="d-flex align-items-center">
                                                <i class="fas fa-check-circle text-primary me-2"></i>
                                                <small class="text-muted">Scalable Teams</small>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="row mt-4 pt-3 border-top">
                                <div class="col-12 text-center">
                                    <a href="{% url 'website:services' %}" class="btn btn-link text-primary">
                                        View All Services <i class="fas fa-arrow-right ms-2"></i>
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </li>
                
                <li class="nav-item">
                    <a class="nav-link position-relative px-3" href="{% url 'website:contact' %}">
                        <span class="nav-text">Contact</span>
                        <span class="nav-hover-effect"></span>
                    </a>
                </li>
            </ul>
            
            <!-- Desktop CTA -->
            <a href="{% if request.path == '/' %}#home-consultation{% else %}{% url 'website:home' %}#home-consultation{% endif %}" 
               class="btn btn-primary ms-4 px-4">
                <i class="fas fa-calendar-check me-2"></i>
                Free Consultation
            </a>
        </div>
        
        <!-- Mobile Toggle Button -->
        <button class="navbar-toggler d-lg-none border-0 shadow-none" 
                type="button" 
                id="mobileMenuToggle"
                aria-label="Toggle navigation">
            <div class="hamburger">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </button>
        
        <!-- Mobile Navigation Overlay -->
        <div class="mobile-nav-overlay" id="mobileNavOverlay"></div>
        
        <!-- Mobile Navigation Sidebar -->
        <div class="mobile-nav-sidebar" id="mobileNavSidebar">
            <div class="mobile-nav-header d-flex align-items-center justify-content-between p-4">
                <div class="logo-wrapper">
                    <span class="logo-text-primary">ServiceLink</span>
                    <span class="logo-text-secondary">BPO</span>
                </div>
                <button class="mobile-nav-close btn-close btn-close-dark" 
                        type="button" 
                        id="mobileNavClose"
                        aria-label="Close"></button>
            </div>
            
            <div class="mobile-nav-content p-4">
                <ul class="mobile-nav-list list-unstyled mb-0">
                    <li class="mb-2">
                        <a href="{% url 'website:home' %}" class="mobile-nav-link d-flex align-items-center py-3 px-3 text-decoration-none rounded">
                            <i class="fas fa-home fa-fw me-3"></i>
                            <span>Home</span>
                        </a>
                    </li>
                    <li class="mb-2">
                        <a href="{% url 'website:about' %}" class="mobile-nav-link d-flex align-items-center py-3 px-3 text-decoration-none rounded">
                            <i class="fas fa-info-circle fa-fw me-3"></i>
                            <span>About Us</span>
                        </a>
                    </li>
                    <li class="mb-2">
                        <div class="mobile-dropdown">
                            <button class="mobile-nav-link d-flex align-items-center justify-content-between w-100 py-3 px-3 text-decoration-none rounded border-0 bg-transparent"
                                    type="button"
                                    data-bs-toggle="collapse"
                                    data-bs-target="#mobileServicesCollapse"
                                    aria-expanded="false"
                                    aria-controls="mobileServicesCollapse">
                                <div class="d-flex align-items-center">
                                    <i class="fas fa-cogs fa-fw me-3"></i>
                                    <span>Services</span>
                                </div>
                                <i class="fas fa-chevron-down"></i>
                            </button>
                            <div class="collapse" id="mobileServicesCollapse">
                                <div class="ps-4 mt-2">
                                    {% for category in categories %}
                                    <a href="{% url 'website:services' %}#{{ category.slug }}" 
                                       class="mobile-submenu-link d-flex align-items-center py-2 text-decoration-none">
                                        <i class="fas fa-chevron-right fa-xs me-2"></i>
                                        <span>{{ category.name }}</span>
                                    </a>
                                    {% empty %}
                                    <a href="{% url 'website:services' %}" 
                                       class="mobile-submenu-link d-flex align-items-center py-2 text-decoration-none">
                                        <i class="fas fa-chevron-right fa-xs me-2"></i>
                                        <span>All Services</span>
                                    </a>
                                    {% endfor %}
                                    <a href="{% url 'website:services' %}" 
                                       class="mobile-submenu-link d-flex align-items-center py-2 text-decoration-none text-primary fw-semibold">
                                        <i class="fas fa-arrow-right fa-xs me-2"></i>
                                        <span>View All Services</span>
                                    </a>
                                </div>
                            </div>
                        </div>
                    </li>
                    <li class="mb-2">
                        <a href="{% url 'website:contact' %}" class="mobile-nav-link d-flex align-items-center py-3 px-3 text-decoration-none rounded">
                            <i class="fas fa-envelope fa-fw me-3"></i>
                            <span>Contact</span>
                        </a>
                    </li>
                </ul>
                
                <div class="mobile-cta mt-5 pt-4 border-top">
                    <a href="tel:+8801886100303" class="btn btn-outline-primary d-flex align-items-center justify-content-center w-100 mb-3 py-3">
                        <i class="fas fa-phone me-2"></i>
                        <span>Call Now</span>
                    </a>
                    <a href="{% url 'website:contact' %}" class="btn btn-primary d-flex align-items-center justify-content-center w-100 py-3">
                        <i class="fas fa-calendar-check me-2"></i>
                        <span>Get Consultation</span>
                    </a>
                </div>
            </div>
        </div>
    </div>
</nav>

<style>
/* ===== FIXED NAVBAR STYLES ===== */
/* Base Navbar - Keep your original styles */
#mainNavbar {
    padding: 0.8rem 0;
    transition: all 0.3s ease;
    z-index: 1030;
}

#mainNavbar.scrolled {
    padding: 0.4rem 0;
    background: rgba(255, 255, 255, 0.98) !important;
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    box-shadow: 0 4px 30px rgba(0, 0, 0, 0.08);
}

/* Logo Styles - Keep original */
.logo-wrapper {
    display: flex;
    align-items: center;
}

.logo-text-primary {
    font-size: 1.75rem;
    font-weight: 800;
    background: linear-gradient(135deg, #4361ee 0%, #3a56d4 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

.logo-text-secondary {
    font-size: 1.75rem;
    font-weight: 600;
    color: #1e3c72;
}

#mainNavbar:not(.scrolled) .logo-text-secondary {
    color: white;
}

/* ===== DESKTOP NAVIGATION ===== */
.desktop-nav {
    width: 100%;
    justify-content: space-between;
}

.desktop-nav .navbar-nav {
    gap: 0.5rem;
}

/* Nav Link Base */
.nav-link {
    position: relative;
    padding: 0.5rem 1rem !important;
    font-weight: 500;
    font-size: 1rem;
    color: #2d3748 !important;
    border-radius: 8px;
    transition: all 0.3s ease;
}

#mainNavbar:not(.scrolled) .nav-link {
    color: white !important;
}

.nav-link .dropdown-arrow {
    font-size: 0.8rem;
    transition: transform 0.3s ease;
}

.dropdown-toggle.show .dropdown-arrow {
    transform: rotate(180deg);
}

/* Hover Effect */
.nav-hover-effect {
    position: absolute;
    bottom: 0;
    left: 50%;
    transform: translateX(-50%) scaleX(0);
    width: 80%;
    height: 2px;
    background: linear-gradient(135deg, #4361ee 0%, #3a56d4 100%);
    border-radius: 1px;
    transition: transform 0.3s ease;
}

.nav-link:hover .nav-hover-effect,
.nav-link.active .nav-hover-effect {
    transform: translateX(-50%) scaleX(1);
}

#mainNavbar:not(.scrolled) .nav-hover-effect {
    background: white;
}

/* ===== MEGA MENU ===== */
.mega-dropdown {
    min-width: 800px;
    max-width: 1000px;
    left: 50% !important;
    transform: translateX(-50%) !important;
    margin-top: 10px !important;
    border-radius: 16px !important;
}

/* Service Category Cards */
.service-category-card {
    border: 1px solid rgba(0, 0, 0, 0.08);
    border-radius: 12px;
    transition: all 0.3s ease;
}

.service-category-card:hover {
    border-color: #4361ee;
    background: rgba(67, 97, 238, 0.02);
    transform: translateY(-2px);
    box-shadow: 0 10px 25px rgba(67, 97, 238, 0.1);
}

.service-icon {
    width: 40px;
    height: 40px;
    background: linear-gradient(135deg, #4361ee 0%, #3a56d4 100%);
    border-radius: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-shrink: 0;
}

.service-icon i {
    color: white;
    font-size: 1rem;
}

/* Mega CTA Box */
.mega-cta {
    background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
}

/* ===== MOBILE NAVIGATION FIXES ===== */
/* Hamburger Menu */
.hamburger {
    width: 30px;
    height: 24px;
    position: relative;
    cursor: pointer;
    display: flex;
    flex-direction: column;
    justify-content: space-between;
}

.hamburger span {
    display: block;
    width: 100%;
    height: 3px;
    background: #4361ee;
    border-radius: 3px;
    transition: all 0.3s ease;
    transform-origin: left center;
}

#mainNavbar:not(.scrolled) .hamburger span {
    background: white;
}

.hamburger.active span:nth-child(1) {
    transform: rotate(45deg) translate(4px, -3px);
    width: 28px;
}

.hamburger.active span:nth-child(2) {
    opacity: 0;
    transform: translateX(-10px);
}

.hamburger.active span:nth-child(3) {
    transform: rotate(-45deg) translate(4px, 3px);
    width: 28px;
}

/* Mobile Overlay - FIXED */
.mobile-nav-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.7);
    backdrop-filter: blur(5px);
    -webkit-backdrop-filter: blur(5px);
    opacity: 0;
    visibility: hidden;
    transition: all 0.3s ease;
    z-index: 1040;
    pointer-events: none;
}

.mobile-nav-overlay.active {
    opacity: 1;
    visibility: visible;
    pointer-events: all;
}

/* Mobile Sidebar - FIXED: Full-screen slide-in */
.mobile-nav-sidebar {
    position: fixed;
    top: 0;
    right: 0;
    width: 320px;
    max-width: 85%;
    height: 100%;
    background: white;
    box-shadow: -5px 0 30px rgba(0, 0, 0, 0.15);
    transform: translateX(100%);
    transition: transform 0.3s ease;
    z-index: 1050;
    display: flex;
    flex-direction: column;
}

.mobile-nav-sidebar.active {
    transform: translateX(0);
}

/* Mobile Header */
.mobile-nav-header {
    border-bottom: 1px solid rgba(0, 0, 0, 0.1);
    background: white;
    flex-shrink: 0;
}

.mobile-nav-close {
    opacity: 0.7;
    transition: opacity 0.3s ease;
    font-size: 1.2rem;
    padding: 0.5rem;
    margin: -0.5rem;
    border-radius: 50%;
}

.mobile-nav-close:hover {
    opacity: 1;
    background: rgba(0, 0, 0, 0.05);
}

/* Mobile Content */
/* Mobile Content */
.mobile-nav-content {
    flex: 1;                /* fills remaining height */
    width: 100%;            /* full width */
    padding: 1rem;          /* spacing inside */
    background-color: #ffffff; /* full white background */
}

.mobile-nav-link {
    color: #2d3748;
    transition: all 0.3s ease;
    border-radius: 8px;
    display: flex;
    align-items: center;
    text-decoration: none;
    padding: 0.75rem 1rem;
    margin-bottom: 0.25rem;
}

.mobile-nav-link:hover,
.mobile-nav-link.active {
    background: rgba(67, 97, 238, 0.1);
    color: #4361ee;
}

.mobile-nav-link[aria-expanded="true"] {
    background: rgba(67, 97, 238, 0.1);
    color: #4361ee;
}

.mobile-nav-link[aria-expanded="true"] .fa-chevron-down {
    transform: rotate(180deg);
    transition: transform 0.3s ease;
}

.mobile-submenu-link {
    color: #64748b;
    transition: all 0.3s ease;
    border-radius: 6px;
    padding: 0.5rem 1rem 0.5rem 2rem;
    display: block;
    text-decoration: none;
}

.mobile-submenu-link:hover {
    color: #4361ee;
    background: rgba(67, 97, 238, 0.08);
}

/* Mobile CTA */
.mobile-cta {
    border-top: 1px solid rgba(0, 0, 0, 0.1);
    background: white;
    padding: 1rem;
    flex-shrink: 0;
}

/* ===== BUTTONS ===== */
.btn-primary {
    background: linear-gradient(135deg, #4361ee 0%, #3a56d4 100%);
    border: none;
    padding: 0.75rem 1.5rem;
    border-radius: 10px;
    font-weight: 600;
    transition: all 0.3s ease;
}

.btn-primary:hover {
    transform: translateY(-2px);
    box-shadow: 0 10px 25px rgba(67, 97, 238, 0.3);
}

.btn-outline-primary {
    border: 2px solid #4361ee;
    color: #4361ee;
    background: transparent;
    transition: all 0.3s ease;
}

.btn-outline-primary:hover {
    background: #4361ee;
    color: white;
}

/* ===== RESPONSIVE ===== */
@media (max-width: 1199.98px) {
    .mega-dropdown {
        min-width: 700px;
    }
}

@media (max-width: 991.98px) {
    .desktop-nav {
        display: none !important;
    }
    
    .mobile-nav-sidebar {
        width: 00px;
    }
}

@media (max-width: 767.98px) {
    .mobile-nav-sidebar {
        width: 280px;
    }
}

@media (max-width: 575.98px) {
    .mobile-nav-sidebar {
        width: 260px;
    }
    
    .logo-text-primary,
    .logo-text-secondary {
        font-size: 1.5rem;
    }
}

/* ===== IMPORTANT FIXES ===== */
/* Remove Bootstrap default dropdown arrow */
.dropdown-toggle::after {
    display: none !important;
}

/* Fix for transparent navbar on hero pages */
#mainNavbar:not(.scrolled) {
    background: transparent !important;
}

#mainNavbar:not(.scrolled) .nav-link:hover {
    background: rgba(255, 255, 255, 0.1);
}

/* Fix body scroll when mobile menu is open */
body.mobile-menu-open {
    overflow: hidden;
    position: fixed;
    width: 100%;
}

/* Ensure proper stacking */
#mainNavbar {
    z-index: 1030 !important;
}

.mobile-nav-overlay {
    z-index: 1040 !important;
}

.mobile-nav-sidebar {
    z-index: 1050 !important;
}

/* Smooth transitions */
#mainNavbar,
.mobile-nav-overlay,
.mobile-nav-sidebar,
.hamburger span {
    transition: all 0.3s ease !important;
}

/* Hide scrollbar for mobile content */
.mobile-nav-content::-webkit-scrollbar {
    width: 4px;
}

.mobile-nav-content::-webkit-scrollbar-track {
    background: transparent;
}

.mobile-nav-content::-webkit-scrollbar-thumb {
    background: rgba(0, 0, 0, 0.1);
    border-radius: 2px;
}
</style>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const navbar = document.getElementById('mainNavbar');
    const hamburger = document.querySelector('.hamburger');
    const mobileMenuToggle = document.getElementById('mobileMenuToggle');
    const mobileNavOverlay = document.getElementById('mobileNavOverlay');
    const mobileNavSidebar = document.getElementById('mobileNavSidebar');
    const mobileNavClose = document.getElementById('mobileNavClose');
    
    // ===== SIMPLE SCROLL HANDLER =====
    function handleScroll() {
        const hasHeroSection = document.querySelector('.hero-section') !== null;
        
        if (hasHeroSection) {
            // On hero pages, show scrolled navbar when not at top
            if (window.scrollY > 10) {
                navbar.classList.add('scrolled');
            } else {
                navbar.classList.remove('scrolled');
            }
        } else {
            // On non-hero pages, always show scrolled navbar
            navbar.classList.add('scrolled');
        }
    }
    
    // Initialize navbar state
    function initializeNavbar() {
        const hasHeroSection = document.querySelector('.hero-section') !== null;
        
        if (!hasHeroSection || window.scrollY > 10) {
            navbar.classList.add('scrolled');
        } else {
            navbar.classList.remove('scrolled');
        }
    }
    
    // Initialize immediately
    initializeNavbar();
    
    // Add scroll listener
    window.addEventListener('scroll', handleScroll);
    
    // ===== FIXED MOBILE MENU FUNCTIONALITY =====
    let isMobileMenuOpen = false;
    
    function openMobileMenu() {
        mobileNavOverlay.classList.add('active');
        mobileNavSidebar.classList.add('active');
        hamburger.classList.add('active');
        document.body.classList.add('mobile-menu-open');
        isMobileMenuOpen = true;
        
        // Prevent body scroll
        document.body.style.overflow = 'hidden';
        document.body.style.position = 'fixed';
        document.body.style.width = '100%';
    }
    
    function closeMobileMenu() {
        mobileNavOverlay.classList.remove('active');
        mobileNavSidebar.classList.remove('active');
        hamburger.classList.remove('active');
        document.body.classList.remove('mobile-menu-open');
        isMobileMenuOpen = false;
        
        // Restore body scroll
        document.body.style.overflow = '';
        document.body.style.position = '';
        document.body.style.width = '';
    }
    
    // Event listeners
    if (mobileMenuToggle) {
        mobileMenuToggle.addEventListener('click', function(e) {
            e.preventDefault();
            e.stopPropagation();
            if (!isMobileMenuOpen) {
                openMobileMenu();
            } else {
                closeMobileMenu();
            }
        });
    }
    
    if (mobileNavClose) {
        mobileNavClose.addEventListener('click', closeMobileMenu);
    }
    
    if (mobileNavOverlay) {
        mobileNavOverlay.addEventListener('click', closeMobileMenu);
    }
    
    // Close menu when clicking a link (mobile)
    document.querySelectorAll('.mobile-nav-link[href], .mobile-submenu-link').forEach(link => {
        link.addEventListener('click', function(e) {
            if (this.getAttribute('href') && this.getAttribute('href') !== '#') {
                setTimeout(closeMobileMenu, 300);
            }
        });
    });
    
    // ===== MEGA MENU SIMPLE FUNCTIONALITY =====
    function initializeMegaMenu() {
        const megaMenu = document.querySelector('.mega-menu');
        const megaDropdown = document.querySelector('.mega-dropdown');
        
        if (megaMenu && megaDropdown && window.innerWidth >= 992) {
            let hideTimeout;
            
            megaMenu.addEventListener('mouseenter', function() {
                clearTimeout(hideTimeout);
                megaDropdown.classList.add('show');
                this.classList.add('show');
            });
            
            megaMenu.addEventListener('mouseleave', function() {
                hideTimeout = setTimeout(() => {
                    megaDropdown.classList.remove('show');
                    this.classList.remove('show');
                }, 200);
            });
            
            megaDropdown.addEventListener('mouseenter', function() {
                clearTimeout(hideTimeout);
            });
            
            megaDropdown.addEventListener('mouseleave', function() {
                hideTimeout = setTimeout(() => {
                    megaDropdown.classList.remove('show');
                    megaMenu.classList.remove('show');
                }, 200);
            });
        }
    }
    
    initializeMegaMenu();
    
    // ===== SET ACTIVE NAV LINK =====
    function setActiveNavLink() {
        const currentPath = window.location.pathname;
        const navLinks = document.querySelectorAll('.nav-link:not(.dropdown-toggle), .mobile-nav-link[href]');
        
        navLinks.forEach(link => {
            const linkPath = link.getAttribute('href');
            if (linkPath === currentPath || 
                (currentPath === '/' && linkPath === '/') ||
                (currentPath.includes('services') && linkPath && linkPath.includes('services'))) {
                link.classList.add('active');
            } else {
                link.classList.remove('active');
            }
        });
    }
    
    setActiveNavLink();
    
    // ===== RESIZE HANDLER =====
    window.addEventListener('resize', function() {
        // Close mobile menu on desktop
        if (window.innerWidth >= 992) {
            closeMobileMenu();
        }
    });
    
    // ===== ESC KEY TO CLOSE MENU =====
    document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape' && isMobileMenuOpen) {
            closeMobileMenu();
        }
    });
    
    // ===== TOUCH SUPPORT =====
    let touchStartX = 0;
    let touchEndX = 0;
    
    mobileNavSidebar.addEventListener('touchstart', function(e) {
        touchStartX = e.changedTouches[0].screenX;
    });
    
    mobileNavSidebar.addEventListener('touchend', function(e) {
        touchEndX = e.changedTouches[0].screenX;
        
        // Swipe right to close
        if (touchEndX - touchStartX > 50 && isMobileMenuOpen) {
            closeMobileMenu();
        }
    });
    
    // ===== CLOSE MENU WHEN CLICKING OUTSIDE =====
    document.addEventListener('click', function(e) {
        if (isMobileMenuOpen && 
            !mobileNavSidebar.contains(e.target) && 
            !mobileMenuToggle.contains(e.target)) {
            closeMobileMenu();
        }
    });
});
</script>