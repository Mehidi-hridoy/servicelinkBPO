<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{% block title %}ServiceLink BPO - Scale Smarter. Grow Faster.{% endblock %}</title>
    
    <!-- Bootstrap 5 CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&family=Montserrat:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    {% load static %}
    <link rel="stylesheet" href="{% static 'css/style.css' %}">
    <link rel="icon" type="image/x-icon" href="{% static 'images/favicon.ico' %}">

    <style>
        /* Notifications Dropdown Styles */
.notifications-dropdown {
    position: relative;
}

.notification-badge {
    position: absolute;
    top: -5px;
    right: -5px;
    background: #e74c3c;
    color: white;
    border-radius: 50%;
    width: 18px;
    height: 18px;
    font-size: 0.7rem;
    display: flex;
    align-items: center;
    justify-content: center;
}

.dropdown-menu.notifications-dropdown-menu {
    min-width: 300px;
    max-width: 350px;
}

.notification-item {
    padding: 0.75rem 1rem;
    border-radius: 8px;
    transition: all 0.3s ease;
    cursor: pointer;
}

.notification-item:hover {
    background-color: rgba(0, 0, 0, 0.05);
}

.notification-item[data-type="success"] {
    border-left: 4px solid #28a745;
}

.notification-item[data-type="info"] {
    border-left: 4px solid #17a2b8;
}

.notification-item[data-type="warning"] {
    border-left: 4px solid #ffc107;
}

.notification-item[data-type="error"] {
    border-left: 4px solid #dc3545;
}

/* Smart Notification System */
.notification-bell-wrapper {
    position: relative;
}

.notification-bell-btn {
    position: relative;
    background: transparent;
    border: none;
    color: inherit;
    font-size: 1.2rem;
    padding: 0.5rem;
}

.notification-count {
    position: absolute;
    top: 0;
    right: 0;
    background: #e74c3c;
    color: white;
    border-radius: 50%;
    width: 18px;
    height: 18px;
    font-size: 0.7rem;
    display: flex;
    align-items: center;
    justify-content: center;
}

.notification-panel {
    position: absolute;
    top: 100%;
    right: 0;
    width: 350px;
    max-height: 500px;
    overflow-y: auto;
    background: white;
    border-radius: 10px;
    box-shadow: 0 10px 30px rgba(0, 0, 0, 0.15);
    display: none;
    z-index: 1050;
}

.notification-panel.show {
    display: block;
}

.notification-panel-header {
    padding: 1rem;
    border-bottom: 1px solid #dee2e6;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.notification-panel-body {
    padding: 0.5rem;
}

.notification-card {
    padding: 1rem;
    margin-bottom: 0.5rem;
    border-radius: 8px;
    border: 1px solid #dee2e6;
    transition: all 0.3s ease;
}

.notification-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
}

.notification-success {
    border-left: 4px solid #28a745;
}

.notification-info {
    border-left: 4px solid #17a2b8;
}

.notification-warning {
    border-left: 4px solid #ffc107;
}

.notification-error {
    border-left: 4px solid #dc3545;
}

.notification-panel-footer {
    padding: 1rem;
    border-top: 1px solid #dee2e6;
}

/* Floating Notification Button */
.floating-notification-btn {
    position: fixed;
    bottom: 30px;
    right: 30px;
    width: 60px;
    height: 60px;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    color: white;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.5rem;
    box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
    cursor: pointer;
    z-index: 1000;
    display: none;
}

.floating-notification-count {
    position: absolute;
    top: -5px;
    right: -5px;
    background: #e74c3c;
    color: white;
    border-radius: 50%;
    width: 24px;
    height: 24px;
    font-size: 0.8rem;
    display: flex;
    align-items: center;
    justify-content: center;
}

/* Mobile Responsive */
@media (max-width: 768px) {
    .notification-panel {
        width: 100vw;
        max-width: 100vw;
        height: 100vh;
        max-height: 100vh;
        position: fixed;
        top: 0;
        right: 0;
        left: 0;
        bottom: 0;
        border-radius: 0;
    }
    
    .floating-notification-btn {
        display: flex;
    }
    
    .notifications-dropdown {
        display: none;
    }
}

/* Toast Animations */
@keyframes slideInRight {
    from {
        transform: translateX(100%);
        opacity: 0;
    }
    to {
        transform: translateX(0);
        opacity: 1;
    }
}

.toast {
    animation: slideInRight 0.3s ease-out;
}
    </style>
    {% block extra_css %}{% endblock %}
</head>
<body>
    <!-- Toast Notifications -->
{% include 'website/includes/toasts.html' %}


    {% include 'website/includes/header.html' %}
    {% include 'website/includes/messages.html' %}
    
    <main>
        {% block content %}{% endblock %}
    </main>
    
    {% include 'website/includes/footer.html' %}
    <script>
        // Smart Notification System
document.addEventListener('DOMContentLoaded', function() {
    // Toggle notification panel
    const notificationBell = document.getElementById('notificationBell');
    const floatingNotificationBtn = document.getElementById('floatingNotificationBtn');
    const notificationPanel = document.getElementById('notificationPanel');
    
    if (notificationBell && notificationPanel) {
        notificationBell.addEventListener('click', function(e) {
            e.preventDefault();
            notificationPanel.classList.toggle('show');
            
            // Close when clicking outside
            if (notificationPanel.classList.contains('show')) {
                document.addEventListener('click', closeNotificationPanelOutside);
            } else {
                document.removeEventListener('click', closeNotificationPanelOutside);
            }
        });
    }
    
    if (floatingNotificationBtn && notificationPanel) {
        floatingNotificationBtn.addEventListener('click', function() {
            notificationPanel.classList.toggle('show');
        });
    }
    
    function closeNotificationPanelOutside(e) {
        if (notificationPanel && !notificationPanel.contains(e.target) && 
            !notificationBell.contains(e.target)) {
            notificationPanel.classList.remove('show');
            document.removeEventListener('click', closeNotificationPanelOutside);
        }
    }
    
    // Mark all as read
    const markAllReadBtn = document.getElementById('markAllRead');
    if (markAllReadBtn) {
        markAllReadBtn.addEventListener('click', function(e) {
            e.preventDefault();
            
            // Send AJAX request to mark all as read
            fetch('/mark-notifications-read/', {
                method: 'POST',
                headers: {
                    'X-CSRFToken': getCookie('csrftoken'),
                    'X-Requested-With': 'XMLHttpRequest'
                }
            })
            .then(response => response.json())
            .then(data => {
                if (data.success) {
                    // Remove notification badges
                    document.querySelectorAll('.notification-count, .notification-badge, .floating-notification-count')
                        .forEach(el => el.remove());
                    
                    // Hide notification panel
                    if (notificationPanel) {
                        notificationPanel.classList.remove('show');
                    }
                    
                    // Show success message
                    showToast('All notifications marked as read!', 'success');
                }
            });
        });
    }
    
    // Auto-show toast notifications
    const toasts = document.querySelectorAll('.toast');
    toasts.forEach(toast => {
        const bsToast = new bootstrap.Toast(toast);
        bsToast.show();
        
        // Auto-remove after hiding
        toast.addEventListener('hidden.bs.toast', function() {
            toast.remove();
        });
    });
    
    // Check for new notifications every 30 seconds
    setInterval(checkNewNotifications, 30000);
    
    // Helper function to get CSRF token
    function getCookie(name) {
        let cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            const cookies = document.cookie.split(';');
            for (let i = 0; i < cookies.length; i++) {
                const cookie = cookies[i].trim();
                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
        return cookieValue;
    }
    
    // Function to check for new notifications
    function checkNewNotifications() {
        fetch('/check-new-notifications/', {
            headers: {
                'X-Requested-With': 'XMLHttpRequest'
            }
        })
        .then(response => response.json())
        .then(data => {
            if (data.has_new) {
                // Show notification badge
                updateNotificationBadge(data.count);
                
                // Show new notification toast
                if (data.latest_notification) {
                    showToast(data.latest_notification.message, 'info', data.latest_notification.title);
                }
            }
        });
    }
    
    // Function to show toast notifications
    function showToast(message, type = 'info', title = 'Notification') {
        const toastContainer = document.querySelector('.toast-container');
        if (!toastContainer) return;
        
        const toastId = 'toast-' + Date.now();
        const iconClass = {
            'success': 'fa-check-circle',
            'info': 'fa-info-circle',
            'warning': 'fa-exclamation-triangle',
            'error': 'fa-exclamation-circle'
        }[type] || 'fa-bell';
        
        const bgClass = {
            'success': 'bg-success text-white',
            'info': 'bg-info text-white',
            'warning': 'bg-warning',
            'error': 'bg-danger text-white'
        }[type] || 'bg-primary text-white';
        
        const toastHTML = `
            <div class="toast align-items-center border-0 ${bgClass}" 
                 id="${toastId}" role="alert" aria-live="assertive" aria-atomic="true">
                <div class="d-flex">
                    <div class="toast-body">
                        <div class="d-flex align-items-center">
                            <div class="me-3">
                                <i class="fas ${iconClass} fa-lg"></i>
                            </div>
                            <div>
                                <strong>${title}</strong>
                                <div class="small">${message}</div>
                            </div>
                        </div>
                    </div>
                    <button type="button" class="btn-close btn-close-white me-2 m-auto" 
                            data-bs-dismiss="toast" aria-label="Close"></button>
                </div>
            </div>
        `;
        
        toastContainer.insertAdjacentHTML('beforeend', toastHTML);
        
        const toastEl = document.getElementById(toastId);
        const bsToast = new bootstrap.Toast(toastEl, {
            autohide: true,
            delay: 5000
        });
        
        bsToast.show();
        
        toastEl.addEventListener('hidden.bs.toast', function() {
            toastEl.remove();
        });
    }
    
    // Function to update notification badge
    function updateNotificationBadge(count) {
        const badges = document.querySelectorAll('.notification-count, .notification-badge, .floating-notification-count');
        
        if (badges.length > 0) {
            badges.forEach(badge => {
                const currentCount = parseInt(badge.textContent) || 0;
                badge.textContent = currentCount + count;
            });
        } else {
            // Create new badges if they don't exist
            const notificationBell = document.querySelector('.notification-bell-btn');
            if (notificationBell) {
                const newBadge = document.createElement('span');
                newBadge.className = 'notification-count';
                newBadge.textContent = count;
                notificationBell.appendChild(newBadge);
            }
            
            const floatingBtn = document.querySelector('.floating-notification-btn');
            if (floatingBtn) {
                const floatingBadge = document.createElement('span');
                floatingBadge.className = 'floating-notification-count';
                floatingBadge.textContent = count;
                floatingBtn.appendChild(floatingBadge);
            }
        }
    }
});
    </script>
    <!-- Bootstrap JS Bundle -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    
    {% load static %}
    <script src="{% static 'js/main.js' %}"></script>
    
    {% block extra_js %}{% endblock %}
</body>
</html>

